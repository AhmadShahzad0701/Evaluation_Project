<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Evaluation - Quizora</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Fraunces:wght@600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="header">
        <div class="container header-content">
            <h1>AI Evaluation</h1>
            <p>Evaluate student answers using Quizora's AI-powered grading engine</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="steps">
            <div class="step active" data-step="1">
                <div class="step-number">1</div>
                <div class="step-label">Evaluation Setup</div>
            </div>
            <div class="step" data-step="2">
                <div class="step-number">2</div>
                <div class="step-label">Upload & Configure</div>
            </div>
            <div class="step" data-step="3">
                <div class="step-number">3</div>
                <div class="step-label">Review & Submit</div>
            </div>
        </div>

        <div class="main-content">
            <!-- Step 1: Evaluation Setup -->
            <div class="step-content active" id="step1">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Choose Evaluation Style</h2>
                        <p class="card-description">Select how strictly you want to evaluate student answers</p>
                    </div>

                    <div class="evaluation-styles">
                        <div class="style-card" data-style="fast" onclick="selectStyle('fast')">
                            <div class="style-icon">‚ö°</div>
                            <div class="style-name">Fast</div>
                            <div class="style-description">Quick & lenient checking</div>
                        </div>
                        <div class="style-card selected" data-style="balanced" onclick="selectStyle('balanced')">
                            <div class="style-icon">‚öñÔ∏è</div>
                            <div class="style-name">Balanced</div>
                            <div class="style-description">Recommended default</div>
                        </div>
                        <div class="style-card" data-style="strict" onclick="selectStyle('strict')">
                            <div class="style-icon">üéØ</div>
                            <div class="style-name">Strict</div>
                            <div class="style-description">Exam-level evaluation</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Evaluation Settings</h2>
                        <p class="card-description">Configure advanced AI evaluation options</p>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Advanced Settings</label>
                        
                        <div class="setting-row">
                            <div>
                                <div class="setting-label">Enable Partial Credit</div>
                                <div class="setting-description">Award marks for partially correct answers</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="partialCredit" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <div class="setting-row">
                            <div>
                                <div class="setting-label">Grammar & Spelling Check</div>
                                <div class="setting-description">Deduct marks for language errors</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="grammarCheck" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <div class="setting-row">
                            <div>
                                <div class="setting-label">Plagiarism Detection (Beta)</div>
                                <div class="setting-description">Check for copied content</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="plagiarismCheck">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Partial Credit Threshold</label>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Minimum understanding required</span>
                                <span class="weight-display" id="thresholdDisplay">50%</span>
                            </div>
                            <input type="range" min="0" max="100" value="50" class="slider" id="thresholdSlider" oninput="updateThreshold(this.value)">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Upload & Configure -->
            <div class="step-content" id="step2">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Quiz Information</h2>
                        <p class="card-description">Enter basic quiz details</p>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Quiz ID <span class="required">*</span></label>
                            <input type="text" class="form-input" id="quizId" placeholder="e.g., QUIZ-2024-001" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Quiz Title <span class="required">*</span></label>
                            <input type="text" class="form-input" id="quizTitle" placeholder="e.g., Data Structures Midterm" required>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Upload Student Submissions</h2>
                        <p class="card-description">Choose your preferred submission format</p>
                    </div>

                    <div class="tab-container">
                        <div class="tabs">
                            <button class="tab active" onclick="switchTab('excel')">üìä Excel/CSV (Recommended)</button>
                            <button class="tab" onclick="switchTab('pdf')">üìÑ Individual PDFs</button>
                            <button class="tab" onclick="switchTab('json')">üíª JSON Batch</button>
                        </div>

                        <div class="tab-content active" id="excelTab">
                            <div class="info-box">
                                <div class="info-box-title">üìã Excel Format Requirements</div>
                                <div class="info-box-content">
                                    Your Excel/CSV file must contain these columns: <code>student_id</code>, <code>question_id</code>, <code>student_answer</code>. Optional columns: <code>time_taken_seconds</code>
                                </div>
                            </div>

                            <div class="file-upload" id="excelUpload" onclick="document.getElementById('excelFile').click()">
                                <div class="upload-icon">üìÅ</div>
                                <h3>Drop Excel/CSV file here or click to browse</h3>
                                <p style="color: var(--text-secondary); margin-top: 0.5rem;">Supports .xlsx, .xls, .csv files up to 50MB</p>
                                <input type="file" id="excelFile" accept=".xlsx,.xls,.csv" style="display: none;" onchange="handleExcelUpload(event)">
                            </div>

                            <div class="file-list hidden" id="excelFileList"></div>
                        </div>

                        <div class="tab-content" id="pdfTab">
                            <div class="info-box">
                                <div class="info-box-title">üìÑ PDF Requirements</div>
                                <div class="info-box-content">
                                    Upload individual student answer sheets as PDF files. Each PDF should be named with the student ID (e.g., S12345.pdf). OCR will be performed automatically.
                                </div>
                            </div>

                            <div class="file-upload" id="pdfUpload" onclick="document.getElementById('pdfFiles').click()">
                                <div class="upload-icon">üìÑ</div>
                                <h3>Drop PDF files here or click to browse</h3>
                                <p style="color: var(--text-secondary); margin-top: 0.5rem;">Select multiple PDF files (max 100 students)</p>
                                <input type="file" id="pdfFiles" accept=".pdf" multiple style="display: none;" onchange="handlePdfUpload(event)">
                            </div>

                            <div class="file-list hidden" id="pdfFileList"></div>
                        </div>

                        <div class="tab-content" id="jsonTab">
                            <div class="info-box">
                                <div class="info-box-title">üíª JSON Format</div>
                                <div class="info-box-content">
                                    Upload a JSON file containing student submissions in the required format. Check documentation for schema details.
                                </div>
                            </div>

                            <div class="file-upload" id="jsonUpload" onclick="document.getElementById('jsonFile').click()">
                                <div class="upload-icon">üíæ</div>
                                <h3>Drop JSON file here or click to browse</h3>
                                <p style="color: var(--text-secondary); margin-top: 0.5rem;">Must follow EvaluationRequest schema</p>
                                <input type="file" id="jsonFile" accept=".json" style="display: none;" onchange="handleJsonUpload(event)">
                            </div>

                            <div class="file-list hidden" id="jsonFileList"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Processing Options</label>
                        
                        <div class="setting-row">
                            <div>
                                <div class="setting-label">Parallel Processing</div>
                                <div class="setting-description">Evaluate multiple students simultaneously (faster but uses more resources)</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="parallelProcessing" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Max Concurrent Requests</label>
                            <p class="card-description" style="margin-bottom: 0.5rem;">Control how many evaluations run simultaneously (recommended: 5-10)</p>
                            <div class="number-input-group">
                                <button class="number-btn" onclick="adjustConcurrent(-1)">‚àí</button>
                                <div class="number-display" id="concurrentDisplay">10</div>
                                <button class="number-btn" onclick="adjustConcurrent(1)">+</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Custom Rubric Definition</h2>
                        <p class="card-description">Define your evaluation criteria - LLM will interpret and apply these automatically</p>
                    </div>

                    <div class="tab-container">
                        <div class="tabs">
                            <button class="tab active" onclick="switchRubricMode('text')">üìù Text-Based Rubric</button>
                            <button class="tab" onclick="switchRubricMode('structured')">‚öôÔ∏è Structured Rubric</button>
                        </div>

                        <div class="tab-content active" id="textRubricTab">
                            <div class="info-box">
                                <div class="info-box-title">üí° How it works</div>
                                <div class="info-box-content">
                                    Describe your evaluation criteria in natural language. The LLM will interpret and apply these criteria when grading. Be as detailed or concise as you need.
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Rubric Description</label>
                                <textarea 
                                    class="form-textarea" 
                                    id="rubricText" 
                                    placeholder="Example:&#10;&#10;Evaluate based on:&#10;1. Depth of understanding (50%) - Student should demonstrate clear grasp of core concepts&#10;2. Use of examples (20%) - Include relevant real-world examples&#10;3. Clarity of explanation (20%) - Answer should be well-structured and easy to follow&#10;4. Technical accuracy (10%) - Correct use of terminology&#10;&#10;Award partial marks for:&#10;- Partially correct concepts&#10;- Good effort even if final answer is wrong&#10;- Creative approaches&#10;&#10;Deduct marks for:&#10;- Completely irrelevant answers&#10;- Plagiarism&#10;- Major factual errors"
                                    style="min-height: 300px;"
                                ></textarea>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Expected Answer Format</label>
                                <textarea 
                                    class="form-textarea" 
                                    id="expectedFormatText" 
                                    placeholder="Example:&#10;&#10;Students should provide:&#10;- A clear definition&#10;- At least 2 examples&#10;- Step-by-step explanation&#10;- Minimum 100 words&#10;- Use of diagrams (if applicable)&#10;&#10;Required keywords: algorithm, complexity, optimization&#10;Required concepts: time complexity, space complexity"
                                    style="min-height: 180px;"
                                ></textarea>
                            </div>
                        </div>

                        <div class="tab-content" id="structuredRubricTab">
                            <div class="info-box">
                                <div class="info-box-title">‚öôÔ∏è Structured Format</div>
                                <div class="info-box-content">
                                    Define specific criteria with weights. Each criterion will be evaluated separately and combined for the final score.
                                </div>
                            </div>

                            <div id="criteriaList">
                                <!-- Initial criteria -->
                                <div class="criteria-item-edit" data-index="0">
                                    <div class="criteria-header">
                                        <input type="text" class="form-input" placeholder="Criterion name (e.g., Conceptual Understanding)" value="Conceptual Understanding">
                                        <button class="button-icon" onclick="removeCriterion(0)">üóëÔ∏è</button>
                                    </div>
                                    <textarea class="form-textarea" placeholder="Describe what you're looking for..." style="min-height: 80px;">Logic, reasoning depth, correctness of core concepts</textarea>
                                    <div class="criteria-weight-row">
                                        <label>Weight (out of 10):</label>
                                        <input type="number" class="form-input" style="width: 80px;" min="0" max="10" value="10">
                                    </div>
                                </div>

                                <div class="criteria-item-edit" data-index="1">
                                    <div class="criteria-header">
                                        <input type="text" class="form-input" placeholder="Criterion name" value="Language Clarity">
                                        <button class="button-icon" onclick="removeCriterion(1)">üóëÔ∏è</button>
                                    </div>
                                    <textarea class="form-textarea" placeholder="Describe what you're looking for..." style="min-height: 80px;">Grammar, structure, readability, professional writing</textarea>
                                    <div class="criteria-weight-row">
                                        <label>Weight (out of 10):</label>
                                        <input type="number" class="form-input" style="width: 80px;" min="0" max="10" value="7">
                                    </div>
                                </div>
                            </div>

                            <button class="button button-secondary" onclick="addCriterion()" style="margin-top: 1rem;">
                                ‚ûï Add Criterion
                            </button>

                            <div class="form-group" style="margin-top: 2rem;">
                                <label class="form-label">Answer Requirements</label>
                                <div class="checkbox-group">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="requireExamples" class="checkbox">
                                        <label for="requireExamples" class="checkbox-label">Requires Examples</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="requireExplanation" class="checkbox" checked>
                                        <label for="requireExplanation" class="checkbox-label">Requires Explanation</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="requireSteps" class="checkbox">
                                        <label for="requireSteps" class="checkbox-label">Requires Step-by-Step Solution</label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Minimum Word Count</label>
                                    <input type="number" class="form-input" id="minWords" placeholder="e.g., 50" min="0">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Maximum Word Count</label>
                                    <input type="number" class="form-input" id="maxWords" placeholder="e.g., 500" min="0">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Required Keywords</label>
                                <p class="card-description" style="margin-bottom: 0.5rem;">Enter keywords that must appear in answers (press Enter after each)</p>
                                <div class="tag-input-container" id="keywordsContainer" onclick="focusTagInput('keywords')">
                                    <input type="text" class="tag-input" id="keywordsInput" placeholder="Type keyword and press Enter" onkeypress="addTag(event, 'keywords')">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Required Concepts</label>
                                <p class="card-description" style="margin-bottom: 0.5rem;">Enter concepts that should be covered (press Enter after each)</p>
                                <div class="tag-input-container" id="conceptsContainer" onclick="focusTagInput('concepts')">
                                    <input type="text" class="tag-input" id="conceptsInput" placeholder="Type concept and press Enter" onkeypress="addTag(event, 'concepts')">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 3: Review & Submit -->
            <div class="step-content" id="step3">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Review Configuration</h2>
                        <p class="card-description">Review your evaluation settings before submitting</p>
                    </div>

                    <div id="reviewContent">
                        <div class="info-box">
                            <div class="info-box-title">‚è≥ Review Summary</div>
                            <div class="info-box-content" id="reviewSummary">
                                Please complete previous steps to see the summary.
                            </div>
                        </div>

                        <div class="review-section">
                            <h3 class="review-section-title">üìã Rubric Preview</h3>
                            <div class="review-rubric" id="reviewRubric">
                                <!-- Will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Additional Notes (Optional)</label>
                        <textarea class="form-textarea" id="additionalNotes" placeholder="Any special instructions or notes for the evaluation..."></textarea>
                    </div>

                    <div class="setting-row">
                        <div>
                            <div class="setting-label">Generate Detailed Reports</div>
                            <div class="setting-description">Create comprehensive PDF reports for each student</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="generateReports" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="setting-row">
                        <div>
                            <div class="setting-label">Email Results to Students</div>
                            <div class="setting-description">Automatically send evaluation results via email</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="emailResults">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">üöÄ Ready to Evaluate</h2>
                        <p class="card-description">Processing time estimate: <strong id="estimatedTime">~5-10 minutes</strong> for 100 students</p>
                    </div>

                    <div class="info-box">
                        <div class="info-box-title">üí° What happens next?</div>
                        <div class="info-box-content">
                            <ol style="margin-left: 1.5rem; margin-top: 0.5rem;">
                                <li>Your submissions will be processed using GPT-4o-mini</li>
                                <li>Each answer will be evaluated against your custom rubric</li>
                                <li>The LLM will interpret your criteria and apply them consistently</li>
                                <li>Detailed feedback will be generated for each student</li>
                                <li>You'll receive a comprehensive report with statistics</li>
                            </ol>
                        </div>
                    </div>

                    <div class="button-group" style="margin-top: 2rem;">
                        <button class="button button-secondary" onclick="previousStep()">
                            ‚Üê Back
                        </button>
                        <button class="button button-primary" onclick="submitEvaluation()">
                            Start Evaluation ‚ú®
                        </button>
                    </div>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="button-group" id="navigationButtons">
                <button class="button button-secondary" onclick="previousStep()" id="prevBtn" style="display: none;">
                    ‚Üê Previous
                </button>
                <button class="button button-primary" onclick="nextStep()" id="nextBtn">
                    Next ‚Üí
                </button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
